<html xmlns:th="http://www.thymeleaf.org">
<!DOCTYPE html>
<html lang="en">
  <head>
  	<link rel="shortcut icon" href="resources/img/favicon.ico">
    <title>장바구니</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    
    <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,700;0,800;1,200;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="resources/css/animate.css">
    <link rel="stylesheet" href="resources/css/owl.carousel.min.css">
    <link rel="stylesheet" href="resources/css/owl.theme.default.min.css">
    <link rel="stylesheet" href="resources/css/magnific-popup.css">
    <link rel="stylesheet" href="resources/css/flaticon.css">
    <link rel="stylesheet" href="resources/css/style.css">
    
    <!-- 추가 css -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="resources/css/cart.css">
  </head>
  <body>

<th:block th:include="includes/header :: header"></th:block>
<!-- END nav -->
    <section class="hero-wrap hero-wrap-2" style="background-image: url('resources/images/bg_2.jpg');" data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row no-gutters slider-text align-items-end justify-content-center">
          <div class="col-md-9 ftco-animate mb-5 text-center">
          	<p class="breadcrumbs mb-0"><span class="mr-2"><a href="index.do">Home <i class="fa fa-chevron-right"></i></a></span> <span>장바구니 <i class="fa fa-chevron-right"></i></span></p>
            <h2 class="mb-0 bread">장바구니</h2>
          </div>
        </div>
      </div>
    </section>
    <section class="ftco-section">
    <div class="container">
    <div class='row ingreCon'>
    	<div id="ingreName">
	    	<div>
	    		<select>
		    		<option>판매순</option>
		    		<option>낮은 가격순</option>
	    		</select>
	    		
	    	</div>
	    	<div th:each="ingre : ${ingre}"> 
	    		<button th:text="${ingre}" class="btn py-3 px-4"></button>
	    	</div> 
    	</div>
    	<div id="ingreList">
    		<div class="ingreContents" id="ingreHead">
    			<div>&nbsp;</div>
    			<div>상품</div>
    			<div>가격</div>
    			<div>판매처</div>
    			<div>&nbsp;</div>
    		</div>
    		<div id="ingreContents">
	    		<!-- <div class="ingreContents" id="ingreCon" th:each="num : ${#numbers.sequence(1,5)}">
	    			<div><img src="resources/img/10.jpg"></div>
	    			<div>광어</div>
	    			<div>20000원</div>
	    			<div>쿠팡</div>
	    			<div><button class="btn py-3 px-4">장바구니 추가</button></div>
	    		</div> -->
	    	</div>
    		<div class="ingreContents ingreOC" id="ingreClose">
    			<div onclick="closeIngre()">닫기</div>
    		</div>
	   		<div class="ingreContents ingreOC" id="ingreOpen">
	   			<div onclick="openIngre()">상품보기</div>
	   		</div>
    	</div>
    	
    </div>
    
    <form name="orderform" id="orderform" method="post" class="orderform" action="checkout" onsubmit="return false;">
    	
            <input type="hidden" name="cmd" value="order">
            <div class="basketdiv table-wrap" id="basket">
               <!-- <table class="table" id="table01">
						<thead class="thead-primary">
						    <tr>
						    	<th>&nbsp;</th>
						    	<th>&nbsp;</th>
						    	<th>상품</th>
						      	<th>가격</th>
						      	<th>개수</th>
						      	<th>총 금액</th>
						      	<th>&nbsp;</th>
						    </tr>
						  </thead>
				</table>
        
                <div class="row data" th:each="num:${#numbers.sequence(1,3)}">
                    <div class="subdiv">
                        <div class="check"><input type="checkbox" name="buy" value="260" onclick="javascript:basket.checkItem();">&nbsp;</div>
                        <div class="img"><img th:src="@{resources/images/}+'prod-'+${num}+'.jpg'" width="70px" height="90px"></div>
                        <div class="pname">
                            <span id="pName2" th:text="'당근'">찜마마(XJ-92214/3)</span>
                            <a id="btn_open" type="button" style="text-align:center" onclick="btnOpen()">상품 더보기</a>
                        </div>
                    </div>
                    <div class="subdiv">
                        <div class="basketprice"><input type="hidden" name="p_price" th:id="'p_price'+${num}" class="p_price" value="20000">20,000원</div>
                        <div class="num">
                            <div class="updown">
                                <input type="text" th:name="'p_num'+${num}" th:id="'p_num1'+${num}" size="2" maxlength="4" class="p_num" value="1" th:onkeyup="'javascript:basket.changePNum(\'' + ${num} + '\');'">
                                <span  th:onclick="'javascript:basket.changePNum(\'' + ${num} + '\');'" style="margin-right:0.3rem; margin-left:0.3rem;"><i class="fas fa-arrow-alt-circle-up up"></i></span>
                                <span th:onclick="'javascript:basket.changePNum(\'' + ${num} + '\');'"><i class="fas fa-arrow-alt-circle-down down"></i></span>
                            </div>
                        </div>
                        <div class="sum">40,000원</div>
                    </div>
                    <div class="subdiv">
                        <div class="basketcmd"><a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delItem();">삭&nbsp;제</a></div>
                    </div>
                </div> -->
                
                
        
            </div>
            <div class="right-align basketrowcmd">
            	<div id="delBtn">
	                <a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delAllItem();">장&nbsp;바&nbsp;구&nbsp;니&nbsp;&nbsp;&nbsp;비&nbsp;우&nbsp;기</a>
	                <a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delCheckedItem();">선&nbsp;택&nbsp;상&nbsp;품&nbsp;&nbsp;&nbsp;삭&nbsp;제</a>
                </div>
            </div>
    
    		<div class="row justify-content-end">
    			<div class="col col-lg-5 col-md-6 mt-5 cart-wrap ftco-animate">
    				<div class="cart-total mb-3">
    					<div class="bigtext right-align sumcount" id="sum_p_num">상품갯수 : 0개</div>
			            <div class="bigtext right-align box summoney" id="sum_p_price">합계금액 : 0원</div>
			            <input type="hidden" id="sum_hidden" value="0" name="price">
    
            <!-- <div id="goorder" class="">
                <div class="clear"></div>
                <div class="buttongroup center-align cmd">
                    <a href="javascript:void(0);">선택한 상품 주문</a>
                </div>
            </div> -->
    				</div>
    				<p class="text-center"><a href="index" class="btn btn-primary py-3 px-4">결&nbsp;제&nbsp;하&nbsp;기</a></p>
    			</div>
    		</div>
            
	</form>
        </div>
	</section>
	<!-- 모달창 구현! -->
	<section>
		<div id="outer">
		    <div class="inner">
		        <div id="modalContents"></div>
					<!-- 
					<span class="btn_close">&times;</span>
		 
		        <div class="title">
		            <span onclick="modalClose()">TITLE</span>
		        </div>
		 		<form name="orderform" id="orderform" method="post" class="orderform" action="/Page" onsubmit="return false;">
    
		            <input type="hidden" name="cmd" value="order">
		            <div class="basketdiv table-wrap overflow-y" id="basket">
		               <table class="table" id="table02">
							<thead class="thead-primary">
								<tr>
								    <th>&nbsp;</th>
								    <th>&nbsp;</th>
								    <th>상품</th>
								    <th>가격</th>
								    <th>&nbsp;</th>
								    <th>&nbsp;</th>
								</tr>
							 </thead>
						</table>
		        
		                <div class="row data" id="data" th:each="num:${#numbers.sequence(1,5)}">
		                    <div class="subdiv" id="modalCon">
		                        <div class="check"><input type="checkbox" name="buy" value="260" onclick="javascript:basket.checkItem();">&nbsp;</div>
		                        <div class="img"><img id="modalImg" th:src="@{resources/images/}+'prod-'+${num}+'.jpg'" width="70px" height="90px"></div>
		                        <div class="pname" id="modalPname">
		                            <span id="modalClick" onclick="pNameClick()" th:text="'식재료'">식재료 이름</span>
		                        </div>
		                    </div>
		                    <div class="subdiv">
		                        <div class="basketprice" id="modalPrice"><input type="hidden" name="p_price" id="p_price" class="p_price" value="20000">20,000원</div>
		                    </div>
		                </div>
		            </div>
				</form>
		        <div class="content">
		        	&nbsp;
		        </div>
					
					 -->
		     
		    </div>
		</div>
	</section>

<th:block th:include="includes/footer :: footer"></th:block>
    
  

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="resources/js/jquery.min.js"></script>
  <script src="resources/js/jquery-migrate-3.0.1.min.js"></script>
  <script src="resources/js/popper.min.js"></script>
  <script src="resources/js/bootstrap.min.js"></script>
  <script src="resources/js/jquery.easing.1.3.js"></script>
  <script src="resources/js/jquery.waypoints.min.js"></script>
  <script src="resources/js/jquery.stellar.min.js"></script>
  <script src="resources/js/owl.carousel.min.js"></script>
  <script src="resources/js/jquery.magnific-popup.min.js"></script>
  <script src="resources/js/jquery.animateNumber.min.js"></script>
  <script src="resources/js/scrollax.min.js"></script>
  <script src="resources/js/main.js"></script>
  <!-- 추가 js -->
  <script src="resources/js/cartEvent.js"></script>
  
  <!-- view -->
  <script>
  
  let ingreContents = document.getElementById('ingreContents');
  let ingreOpen = document.getElementById('ingreOpen');
  let ingreClose = document.getElementById('ingreClose');
  function openIngre(){
	  ingreOpen.style.display="none";
	  ingreContents.style.display="block";
	  ingreClose.style.display="block";
	  
  }
  function closeIngre(){
	  ingreClose.style.display="none";
	  ingreContents.style.display="none";
	  ingreOpen.style.display="block";
  }
    $(document).ready(()=>{
  		loadList();
  	});
    
    function loadList(){
    	
  		$.ajax({
  			url : "cartAjaxList.do", 
  			type : "get",
  			dataType : "json", 
  			success : cartHtml, 
  			error : function(){alert("error");}
  		});
  	}
    function cartHtml(cartList){
    	
    	let view2="";
      	for(var i = 0; i <5; i++){
      		view2+=`<div class="ingreContents" id="ingreCon">
    			<div><img src="resources/img/10.jpg" id="img${i}"></div>
    				<div id="name${i}">연어${i}</div>
    				<div id="price${i}">2000${i}원</div>
    				<div>쿠팡</div>
    				<div><button class="btn py-3 px-4" onclick="addCart(${i}); closeIngre();">장바구니 추가</button></div>
    			</div>`;
      	}
      	
      	$("#ingreContents").html(view2);
      	
      	loadCart();
    	
    }
    function loadCart(){
    	$.ajax({
  			url : "cartAjaxList.do", 
  			type : "get",
  			dataType : "json", 
  			success : addCartHtml, 
  			error : function(){alert("error");}
  		});
    }
   	function addCartHtml(addCartList){
   		let view="";
   		view+="<table class='table' id='table01'>";
		view+="<thead class='thead-primary'>";
		view+="<tr>";
		view+="<th>&nbsp;</th>";
		view+="<th>&nbsp;</th>";
		view+="<th>상품</th>";
		view+="<th>가격</th>";
		view+="<th>개수</th>";
		view+="<th>총 금액</th>";
		view+="<th>&nbsp;</th>";
		view+="</tr>";
		view+="</thead>";
		view+="</table>";
		view+="<div id='cartDiv'>";
		/* $.each(addCartList, function(index, obj){
			view+="<div class='row data'>";
			view+="<div class='subdiv'>";
			view+="<div class='check'><input type='checkbox' name='buy' value='260' onclick='javascript:basket.checkItem();'>&nbsp;</div>";
			view+="<div class='img'><img src='"+obj.img+"' width='70px' height='90px'></div>";
			view+="<div class='pname'>";
			view+="<span id='pName2'>"+obj.name+"</span>";
			view+="<a id='btn_open' type='button' style='text-align:center' onclick='btnOpen()'>상품 더보기</a>";
			view+="</div>";
			view+="</div>";
			view+="<div class='subdiv'>";
			view+="<div class='basketprice'><input type='hidden' name='p_price' id='p_price"+index+"' class='p_price' value='"+obj.price+"'>"+obj.price+"원</div>";
			view+="<div class='num'>";
			view+="<div class='updown'>";
			view+="<input type='text' name='p_num"+index+"' id='p_num1"+index+"' size='2' maxlength='4' class='p_num' value='1' onkeyup='javascript:basket.changePNum("+index+");'>";
			view+="<span onclick='javascript:basket.changePNum("+index+");' style='margin-right:0.3rem; margin-left:0.3rem;'><i class='fas fa-caret-up up'></i></span>";
			view+="<span onclick='javascript:basket.changePNum("+index+");'><i class='fas fa-caret-down down'></i></span>";
			view+="</div>";
			view+="</div>";
			view+="<div class='sum'>"+obj.price+"원</div>";
			view+="</div>";
			view+="<div class='subdiv'>";
			view+="<div class='basketcmd'><a href='javascript:void(0)' class='abutton' onclick='javascript:basket.delItem();'>삭&nbsp;제</a></div>";
			view+="</div>";
			view+="</div>";
		}); */
		view+="</div>";

    	$("#basket").html(view);
   	}

    	let num = 0;
    function addCart(id){
    	let view = "";
  		let price = $("#price"+id).text();
  		let name = $("#name"+id).text();
  		let img = $("#img"+id).attr("src");
  		 view += `<div class="row data">
            <div class="subdiv">
                <div class="check"><input id="checkbox${num}" type="checkbox" name="buy" value="260" onclick="javascript:basket.checkItem(); updatePrice(${num});">&nbsp;</div>
                <div class="img"><img src="${img}" width="70px" height="90px"></div>
                <div class="pname">
                    <span id="pName2">${name}</span>
                </div>
            </div>
            <div class="subdiv">
                <div class="basketprice"><input type="hidden" name="p_price" id="p_price${num}" class="p_price">${price}</div>
                <div class="num">
                    <div class="updown">
                        <input type="text" name="p_num${num}" id="p_num${num}" size="2" maxlength="4" class="p_num" value="1" onkeyup="javascript:basket.changePNum(${num});">
                        <span onclick="javascript:basket.changePNum(${num}); upPrice(${num});" style="margin-right:0.3rem; margin-left:0.3rem;"><i class="fas fa-arrow-alt-circle-up up"></i></span>
                        <span onclick="javascript: downPrice(${num}, basket.changePNum(${num}));"><i class="fas fa-arrow-alt-circle-down down"></i></span>
                    </div>
                </div>
                <div class="sum${num}">${price}</div>
                <input id="sum${num}" type="hidden" value=${price}>
            </div>
            <div class="subdiv">
                <div class="basketcmd"><a href="javascript:void(0)" class="abutton" onclick="javascript:basket.delItem();">삭&nbsp;제</a></div>
            </div>
        </div>`;
  		
        $("#cartDiv").append(view);
        num++;
  	} 
    function upPrice(num){
    	let p_num = $("#p_num"+num).val()
    	let sum = $("#sum"+num).val();
    	let result = sum.slice(0,-1);
    	let resultSum = result * p_num;
    	//let total = $("#sum_p_price").text();
    	
    	$(".sum"+num).text(resultSum+"원");
    	
    	let total = $("#sum_p_price")
    	//let totalVal = total.text().slice(5,-1);
    	
    	let sumHidden = $("#sum_hidden").val();
    	let checkTF = $("#checkbox"+num).prop("checked");
    	if(checkTF == true){
	    	let totalSum = (Number(sumHidden) + Number(result));
    		total.text("합계금액 : "+ totalSum + "원");
    		$("#sum_hidden").val(totalSum);
    	}
    	if(checkTF == false){
    		total.text("합계금액 : "+ sumHidden + "원");
    	}
    	
    }
    function downPrice(num, is_down){
    	let p_num = $("#p_num"+num).val()
    	let sum = $("#sum"+num).val();
    	let result = sum.slice(0,-1);
    	let resultSum = result * p_num;
    	//let total = $("#sum_p_price").text();
    	
    	$(".sum"+num).text(resultSum+"원");
    	
    	let total = $("#sum_p_price")
    	//let totalVal = total.text().slice(5,-1);
    	
    	let sumHidden = $("#sum_hidden").val();
    	let checkTF = $("#checkbox"+num).prop("checked");
    	
    	if(checkTF == true){
    		if(is_down){
    			let totalSum = (Number(sumHidden) - Number(result));
	    		total.text("합계금액 : "+ totalSum + "원");
	    		$("#sum_hidden").val(totalSum);
    			
    			
    		}else{
    			total.text("합계금액 : "+ sumHidden + "원");
    		}
    	}
    	if(checkTF == false){
    		total.text("합계금액 : "+ sumHidden + "원");
    	}
    }
    function updatePrice(num){
    	let sum = $(".sum"+num).text();
    	let result = sum.slice(0,-1);
    	
    	let total = $("#sum_p_price")
    	//let totalVal = total.text().slice(5,-1);
    	
    	let sumHidden = $("#sum_hidden").val();
    	let checkTF = $("#checkbox"+num).prop("checked");
    	if(checkTF == true){
	    	let totalSum = (Number(sumHidden) + Number(result));
    		total.text("합계금액 : "+ totalSum + "원");
    		$("#sum_hidden").val(totalSum);
    	}
    	if(checkTF == false){
    		
	    	let totalSum = (Number(sumHidden) - Number(result));
    			total.text("합계금액 : "+ totalSum + "원");
    			$("#sum_hidden").val(totalSum);
    	}
    }
    </script>
  
  <!-- 모달창 js -->
<!-- <script>
    var outer = document.getElementById('outer');
    var btn_open = document.getElementById("btn_open");
    var btn_close = document.getElementsByClassName("btn_close")[0];
    let pNam2 = document.getElementById('pName2')
	let body = document.getElegmentByTagName('body')
    /*btn_open.onclick = function () {
        outer.style.display = "block";
    };
    btn_close.onclick = function () {
        outer.style.display = "none";
    };*/
    function btnOpen(){
    	outer.style.display = "block";
    	modalAjax();
    }
 	function modalClose(){
        outer.style.display = "none";
 	}
 
    window.onclick = function (event) {
        if (event.target == outer) {
            outer.style.display = "none";
        }
    }
    function modalAjax(){
    	
    	$.ajax({
    		url : "madalAjax",
    		type : "get",
    		dataType : "json",
    		success : modalList,
    		error : function(){alert("error");}
    	})
    }
    
    function modalList(modalCartList){
    	let view="";
    	view+="<span class='btn_close' onclick='modalClose()'>&times;</span>";
    	view+="<div class='title'>";
    	view+="<span>TITLE</span>";
    	view+="</div>";
    	view+="<form name='orderform' id='orderform' method='post' class='orderform' action='/Page' onsubmit='return false;'>";
    	view+="<input type='hidden' name='cmd' value='order'>";
    	view+="<div class='basketdiv table-wrap overflow-y' id='basket'>";
    	view+="<table class='table' id='table02'>";
    	view+="<thead class='thead-primary'>";
    	view+="<tr>";
    	view+="<th>&nbsp;</th>";
    	view+="<th>&nbsp;</th>";
    	view+="<th>상품</th>";
    	view+="<th>가격</th>";
    	view+="<th>&nbsp;</th>";
    	view+="<th>&nbsp;</th>";
    	view+="</tr>";
    	view+="</thead>";
    	view+="</table>";
    	$.each(modalCartList, function(index, item){
	    	view+="<div class='row data' id='data'>";
	    	view+="<div class='subdiv' id='modalCon'>";
	    	view+="<div class='check'><input type='checkbox' name='buy' value='260' onclick='javascript:basket.checkItem();'>&nbsp;</div>";
	    	view+="<div class='img'><img id='modalImg' src='"+item.img+"' width='70px' height='90px'></div>";
	    	view+="<div class='pname' id='modalPname'>";
	    	view+="<span id='modalClick' onclick='pNameClick()'>"+item.name+"</span>";
	    	view+="</div>";
	    	view+="</div>";
	    	view+="<div class='subdiv'>";
	    	view+="<div class='basketprice' id='modalPrice'><input type='hidden' name='p_price' id='p_price' class='p_price' value='"+item.price+"'>"+item.price+"원</div>";
	    	view+="</div>";
	    	view+="</div>";
    	});
    	view+="</div>";
    	view+="</form>"; 
       	view+="<div class='content'>&nbsp;</div>";

    	   
    	$("#modalContents").html(view);
    }
    

    function pNameClick(){
    	outer.style.display = "none";
    	
    	$.ajax({
    		url : "pNameAjax",
    		type : "get",
    		dataType : "json",
    		success : cartHtml,
    		error : function(){alert("error");}
    	})
    	
    }
	</script> -->  
  </body>
</html>